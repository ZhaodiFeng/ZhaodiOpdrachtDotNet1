DECLARE @CurrentMigration [nvarchar](max)

IF object_id('[dbo].[__MigrationHistory]') IS NOT NULL
    SELECT @CurrentMigration =
        (SELECT TOP (1) 
        [Project1].[MigrationId] AS [MigrationId]
        FROM ( SELECT 
        [Extent1].[MigrationId] AS [MigrationId]
        FROM [dbo].[__MigrationHistory] AS [Extent1]
        WHERE [Extent1].[ContextKey] = N'DAL.Migrations.Configuration'
        )  AS [Project1]
        ORDER BY [Project1].[MigrationId] DESC)

IF @CurrentMigration IS NULL
    SET @CurrentMigration = '0'

IF @CurrentMigration < '201711052243202_Init'
BEGIN
    CREATE TABLE [dbo].[Albums] (
        [Id] [int] NOT NULL IDENTITY,
        [Name] [nvarchar](max) NOT NULL,
        [ReleaseDate] [datetime],
        [Description] [nvarchar](max),
        CONSTRAINT [PK_dbo.Albums] PRIMARY KEY ([Id])
    )
    CREATE TABLE [dbo].[PublisherAlbums] (
        [Id] [int] NOT NULL IDENTITY,
        [PublisherId] [int] NOT NULL,
        [AlbumId] [int] NOT NULL,
        CONSTRAINT [PK_dbo.PublisherAlbums] PRIMARY KEY ([Id])
    )
    CREATE INDEX [IX_PublisherId] ON [dbo].[PublisherAlbums]([PublisherId])
    CREATE INDEX [IX_AlbumId] ON [dbo].[PublisherAlbums]([AlbumId])
    CREATE TABLE [dbo].[Publishers] (
        [Id] [int] NOT NULL IDENTITY,
        [Name] [nvarchar](max) NOT NULL,
        [FoundingDate] [datetime],
        [Profile] [nvarchar](max),
        CONSTRAINT [PK_dbo.Publishers] PRIMARY KEY ([Id])
    )
    CREATE TABLE [dbo].[TrackAlbums] (
        [Id] [int] NOT NULL IDENTITY,
        [TrackId] [int] NOT NULL,
        [AlbumId] [int] NOT NULL,
        [Squence] [int],
        CONSTRAINT [PK_dbo.TrackAlbums] PRIMARY KEY ([Id])
    )
    CREATE INDEX [IX_TrackId] ON [dbo].[TrackAlbums]([TrackId])
    CREATE INDEX [IX_AlbumId] ON [dbo].[TrackAlbums]([AlbumId])
    CREATE TABLE [dbo].[Tracks] (
        [Id] [int] NOT NULL IDENTITY,
        [Name] [nvarchar](max) NOT NULL,
        [ReleaseDate] [datetime],
        [Downloads] [int],
        [Duration] [time](7),
        CONSTRAINT [PK_dbo.Tracks] PRIMARY KEY ([Id])
    )
    CREATE TABLE [dbo].[ArtistTracks] (
        [Id] [int] NOT NULL IDENTITY,
        [ArtistId] [int] NOT NULL,
        [TrackId] [int] NOT NULL,
        CONSTRAINT [PK_dbo.ArtistTracks] PRIMARY KEY ([Id])
    )
    CREATE INDEX [IX_ArtistId] ON [dbo].[ArtistTracks]([ArtistId])
    CREATE INDEX [IX_TrackId] ON [dbo].[ArtistTracks]([TrackId])
    CREATE TABLE [dbo].[Artists] (
        [Id] [int] NOT NULL IDENTITY,
        [Name] [nvarchar](max) NOT NULL,
        [BirthDay] [datetime],
        [Bio] [nvarchar](max),
        CONSTRAINT [PK_dbo.Artists] PRIMARY KEY ([Id])
    )
    CREATE TABLE [dbo].[TrackGenres] (
        [Id] [int] NOT NULL IDENTITY,
        [TrackId] [int] NOT NULL,
        [GenreId] [int] NOT NULL,
        CONSTRAINT [PK_dbo.TrackGenres] PRIMARY KEY ([Id])
    )
    CREATE INDEX [IX_TrackId] ON [dbo].[TrackGenres]([TrackId])
    CREATE INDEX [IX_GenreId] ON [dbo].[TrackGenres]([GenreId])
    CREATE TABLE [dbo].[Genres] (
        [Id] [int] NOT NULL IDENTITY,
        [Name] [nvarchar](max) NOT NULL,
        CONSTRAINT [PK_dbo.Genres] PRIMARY KEY ([Id])
    )
    ALTER TABLE [dbo].[PublisherAlbums] ADD CONSTRAINT [FK_dbo.PublisherAlbums_dbo.Albums_AlbumId] FOREIGN KEY ([AlbumId]) REFERENCES [dbo].[Albums] ([Id]) ON DELETE CASCADE
    ALTER TABLE [dbo].[PublisherAlbums] ADD CONSTRAINT [FK_dbo.PublisherAlbums_dbo.Publishers_PublisherId] FOREIGN KEY ([PublisherId]) REFERENCES [dbo].[Publishers] ([Id]) ON DELETE CASCADE
    ALTER TABLE [dbo].[TrackAlbums] ADD CONSTRAINT [FK_dbo.TrackAlbums_dbo.Albums_AlbumId] FOREIGN KEY ([AlbumId]) REFERENCES [dbo].[Albums] ([Id]) ON DELETE CASCADE
    ALTER TABLE [dbo].[TrackAlbums] ADD CONSTRAINT [FK_dbo.TrackAlbums_dbo.Tracks_TrackId] FOREIGN KEY ([TrackId]) REFERENCES [dbo].[Tracks] ([Id]) ON DELETE CASCADE
    ALTER TABLE [dbo].[ArtistTracks] ADD CONSTRAINT [FK_dbo.ArtistTracks_dbo.Artists_ArtistId] FOREIGN KEY ([ArtistId]) REFERENCES [dbo].[Artists] ([Id]) ON DELETE CASCADE
    ALTER TABLE [dbo].[ArtistTracks] ADD CONSTRAINT [FK_dbo.ArtistTracks_dbo.Tracks_TrackId] FOREIGN KEY ([TrackId]) REFERENCES [dbo].[Tracks] ([Id]) ON DELETE CASCADE
    ALTER TABLE [dbo].[TrackGenres] ADD CONSTRAINT [FK_dbo.TrackGenres_dbo.Genres_GenreId] FOREIGN KEY ([GenreId]) REFERENCES [dbo].[Genres] ([Id]) ON DELETE CASCADE
    ALTER TABLE [dbo].[TrackGenres] ADD CONSTRAINT [FK_dbo.TrackGenres_dbo.Tracks_TrackId] FOREIGN KEY ([TrackId]) REFERENCES [dbo].[Tracks] ([Id]) ON DELETE CASCADE
    

	CREATE TABLE [dbo].[__MigrationHistory] (
        [MigrationId] [nvarchar](150) NOT NULL,
        [ContextKey] [nvarchar](300) NOT NULL,
        [Model] [varbinary](max) NOT NULL,
        [ProductVersion] [nvarchar](32) NOT NULL,
        CONSTRAINT [PK_dbo.__MigrationHistory] PRIMARY KEY ([MigrationId], [ContextKey])
    )
    INSERT [dbo].[__MigrationHistory]([MigrationId], [ContextKey], [Model], [ProductVersion])
    VALUES (N'201711052243202_Init', N'DAL.Migrations.Configuration',  0x1F8B0800000000000400ED5DCD6EE43612BE2FB0EF20E8B4594CDCB6E790ACD19DC0D33D0E8C1D8F07D39E606F062DD16D2112D591286F1BC13ED91EF248FB0A4BFDF35F945A2DA90D23C0C02D9255C5AAAFF853242BFFFBEF9FF39F77816F3DC328F642B4B0CF4E4E6D0B2227743DB459D8097EFCFE47FBE79FFEFA97F94737D859BF96F5DEA7F5484B142FEC278CB717B359EC3CC100C42781E744611C3EE213270C66C00D67E7A7A7FF989D9DCD202161135A9635FF9A20EC0530FB417E2E43E4C02D4E807F13BAD08F8BEFA4649D51B53E8300C65BE0C085BDBAFC645B97BE0708EB35F41F6D0B20146280896017DF62B8C6518836EB2DF900FCBB972D24F51E811FC342E08BBABAA9ECA7E7A9ECB3BA6149CA49621C062D099EBD2F9431E39B7752A95D298BA8EB23512B7E497B9DA96C615FFA0F49605B3CA78BA51FA5B51676A6F093ACDA3B2BFBF1AE32334143FADF3B6B99F83889E002C1044780D4F8923CF89EF34FF87217FE06D10225BE4FCB41242165CC07F2E94B146E61845FBEC2C742BA6BD7B6666CBB19DFB06A46B5C945BF46F8FDB96D7D26CCC1830F2B3353DD5CE33082BF40042380A1FB05600C2394D28099A204EE1CAFF4DF921BC115F109DBBA01BB4F106DF013D11DD8D9D695B7836EF9A590E01BF2880B9146384AA044423DD7AFD08720862B2272C93CFDFBCE0B1A9BAE60EC44DE3607D3DE7273BC3E83676F93E995E39AA1217E825106A3D8B6480FB27AF193B7CDBDF484AD735FE0F22A0A83AFA12FD0C8CBEFEF40B48198F424D4545A8749E4B490F68E40D8F94D23EA5D552E8AC99709220A1564E2CD67B5A36ADD97ED70B31FB3F5DF1C9AE755E9A799A99E50A6DFD64494982CCCDB97DF9498D3FA4D89DCD65EAE97F35E180D24C2F295D49E2ED4ECC79F5AB8D29B174D635ABC0A13942E4BBBCC8BE4E7A3E7F721F441E6C46E3EA3F472A57775F2997A466B769ABAEE9BD7F0BC32DD8C33EF7044D6BF27648F073922FBCF55AD164E3C7A952B2BE3755D4A402DD7FD1DBDECE304A30BE54B3AA6C65E735021A7912BBD79D134E69E7DB664E1BF911F0237D6BB1BDF2A8900BD8B937252BB6884BD18670892CF3C5485FB028FB5470885824788355A6FC24CF660E62E2B1D4CA44EDD4A4002D3086A04CCCA4505F265F21185AEB0D7804259C320D253577E1B5C84D93553CEBED36BB789BEC199356E7CCFBA3BEFC84CB1C295D93A9D9CB98F71867763F548B487A398FAC89B7B4C63EEFDE045F869055EDA4EBC1FBC70C0FD9EE194DBCA57E5EE20F7E7EE4BD16C1E325C8F6675DF1CE3205BBB4CB7FD4D1B85592548A4161EE502A7C6A15028CC18628DFEE68B56AB2AE9A24FB6ECEAE41B866EF1E611525E034D159D97EF2D7D80879ADA4B4CB07619C7A1E3652249A38545F484EDEA47E45A2621FF5CE5E2D101D13FC1A2B725E823222DECBF0BCA6CE0508D03350729E1339B87EF2D5A91FD3386D6A5939F922F41EC00573427D197CB7E218887510A39E02F8901890F79088BEEE121C7DB02DF407CAEADA173A5B2555CF89215DC4294FA85817D4CD857313E51868A15A7B72635CD6714E60CA12804A51BD1A28E504B407950D8980827C1735B8FD90F9D2A750D095195564C64600E5347C1AA107056A1401D7DAE8D4F9F73980F95EA0B01931F2655A20F803F953DA63F3CCAB6712A6C68F774143C8AB0C420E3A13626C4CB54ACC10F320C6A94330000356A30C26015281C118474584D6F6E698CADA3B175B4254092521D7FEC53CA3E18F6243631E15D851AC69B70996319EDBC283FA319121C3A8154683DE4E24FA996A1265D9906A68F3B71BBAE32B366EF5E9BB988ED0C823B4D408DC39D54AA9E70A754CB00B8536AC0847715151D6FBCA3E391DAD1451A9CEC66640DE5E3996455A20F35D649EC31B5A12E0F10923698B4805121C14D127B4EFA11EE64C795DF625844A1E32250CA832725BA8698DE31C5B6554723D98DA9803DB6B9703951A0C3C74D4C096A693592616E870874E8A9DC849092466373F6484F5432BDBA3622A5A662D69532A22DEF4F3102351052D29037A7E0AD024E792790AAAABBE3CEFB9E61FCBBEA8704B7823F1B46BC299A72528C7B937A6D7423DEFDD528481F936D199595A9CA504BCA60AAB9FA3BE84C08F74954A50F099A0505A94E30638C4633CA30E021B023BD4A20AAA23154651CACA23B518E501A65E8624C02A952FE9EB4C2DC3552E9441939318C9D1876C2305AC2C3AD375761EF4F2A7C45BD9B37DCCF378A6FB80D37F3BA0EBA909CF58ABA68D8611AEE31A93E94AC34BA506F0D795DC88975C50573C142010BE5A6C76CDB63D601B38DCE3EFE511EC1572BECAA6C3ECBDF96171FE633C523F4F90DD86E3DB4A11EA5175FAC75FE227DF9FDBAFDCBED20A7317318A0F1FB818A130E23B0815C29614D24BDF2A218AF00060F20BD21B17403A11AB39F50ACFB4A56CC9641B456B91A2CABA77F1757D62F3F9D48A7DC5A6357A41341BA49CB6E97F053A3D8CE4A1300001F44929B2CCBD04F02A4DE2CAA5BE77753E8F6F917730ACC73009A1053604E8F79B64DD3630A447AF319A75861C32A184CD8E8B3E6370247F322548F126EBBD81E2E4D040E831BE6BC9B26A33D0857D3AB0E32695ACAD3CDF1ADBD87A1F7B1F1F10C0BEC0B559A125BD20272E5BB55066EE5C7C94044BF84D463848AD3B40789AEF161505205076912CA88A19A4E5BE757D1A9DE72D274AA8FD34248477074C5C5F10C1CBDAF27EA3787CC6AA2FEDC8256F5129121557D9D0CC41AE21C0D0B572A48DB61F9AA6B7D18D0D53750980144792F454DA9ED8836AA79BB5AB6B3518F6710A9DF49D154EAAF6D28853C91704248D007690C2694FC08A3E3ACA2683CEDD546758A4ED3511EAD8F66D98E46ED6ACF414D69EEE00755BE1010E3AB54DCABC01817009B17C1A8E6548D42742AAF625B4435CF9E9B46A6D62F3186C1495AE164FDBBBFF43DD2DFBAC20D40DE2324536BF658CA3E3F3D3BE7923F4E2711E32C8E5D5F12CC13B231B2C61AE0B99797AAB4F14157CBE78A397A7306E81944CE1388FE1680DD777D24D770C9DF387BE35BD392BEC76DCE7FA8944DA4D7352DDFEB30A824375EC647B87E728D5CB85BD87F64ED2EACEB7FDD534DDF59B71171DC0BEBD4FACFBED98D4CD917CD5AB0EE9030EE7518B93FAF95A563EBEAB65C7AB643B8AC2A5274B496AC5681ED7CA568761C6E2AB2E6529765ACFBC3C72B81C634A7663E0F56A3ED2434B8AC58B91C5F22E878795EF21F7A428332A073B498E0531B193B6DD16E2FAF1D6CAC6A9B0AE875D8B63F7FE773ED7475762AF7CEC12673C9EEFD682D38E264CEA59D31655D343B846FBE26C37675CD03A50E29AECD0EFA365D75C97AF8CC0BAA53E6036700398257ED7B24FD9846768F9110A5BBE03205541D518A8E718726FAB5D090EF81071B92B4D76CA6361CB54FB23176428DE232F508193406CE58F0BAD26388663BFC53DA2940C7DC94032367C8B7B77BA7B7183797C508B3D560B069395B8D8B9A96C92946CB4441BFFE1D3CF7C4B08FFE5F5D6A8971879A114033EC50630E9A21871AEEA64E2181F8E68BB79D24FB833AF9437E276761BB0F69C8360F48299E5EF294F92DB6C082AF20E3D5F44C5CC9549F3B42CBAA990B3D950A6CE842191FDDF355292375EA0925F966CACC2A52B43E5D2AC580EE75B69C97266D859A83A18A8AB146AEA7A250A92CC5F3599E918A8786BC82F290E930189452AF298D1239888D1B72B94C39D385BC1F935184100ADB2F7D4517BB8BC31AFF8CAAAF3C0C07C94E21C9BC609A734195B4A1B70ED3E1863D134F88024B451DA1ABE206B98FB4122DBB3A04880F9333424C10619811419150A12F8BF69C10A28B3D7BEA668B7C0FE23576B2544F507ADD21FFB582B1B7A949CC094D041D66915ED5B9468F61B959E0242AAB7027C337100397ACE053077D040E26C50E8CE3ECFF94F12BF01352E563F000DD6B749BE06D82499761F0E0330F79D23D878E7F96D48295797E9BDD8E8EFBE80211D34B6F88DCA20F89E7BB95DC5792F36C05897433531CB7A7B6C4E9B1FBE6A5A2F4394486840AF5557BB03B186C7D422CBE456BF00CBBC8F62D869FE006382FE56B0435916643B06A9FAF3CB08940101734EAF6E427C1B01BEC7EFA3F08FBF9B29E830000 , N'6.2.0-61023')
END

